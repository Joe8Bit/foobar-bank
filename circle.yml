machine:
  node:
    version: 0.10.33

dependencies:
  pre:
    - bower install
    - sudo pip install awscli==1.7.8
    - npm prune
  post:
    - wget https://saucelabs.com/downloads/sc-latest-linux.tar.gz
    - tar -xzf sc-latest-linux.tar.gz
  cache_directories:
    - ~/nvm

test:
  pre:
    - npm run config
  override:
    - npm run hint
    - npm run codestyle
    - npm run test
    - npm run e2e

override:
    - ./bin/sc -u $SAUCE_USERNAME -k $SAUCE_ACCESS_KEY -f ~/sc_ready:
        background: true
        pwd: sc-*-linux
    # Wait for tunnel to be ready
    - while [ ! -e ~/sc_ready ]; do sleep 1; done
    - ./node_modules/.bin/gulp server:e2e:
        background: true
    # Wait for app to be ready
    - curl --retry 10 --retry-delay 2 -v http://localhost:3000
    # Run selenium tests
    - npm run e2e:sauce

# deployment:
#   production:
#     branch: master
#     commands:
#       - ./node_modules/.bin/gulp build
#       - aws s3 sync build s3://teachdigital.io/ --delete --acl public-read